<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desafio Di√°rio - Steam Achievements Explorer</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Rajdhani:wght@300;400;600;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="languages.js"></script>
    <style>
        :root {
            --primary-color: #00f3ff;
            --secondary-color: #bc13fe;
            --bg-dark: #050b14;
            --bg-panel: rgba(16, 26, 46, 0.95);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #e0e6ed;
            --text-dim: #94a3b8;
            --success: #00ff9d;
            --warning: #ffbd2e;
            --danger: #ff0055;
            --gold: #ffd700;
            --font-display: 'Orbitron', sans-serif;
            --font-body: 'Rajdhani', sans-serif;
        }

        /* TEMAS */
        body.theme-matrix { --primary-color: #00ff41; --secondary-color: #008f11; --bg-dark: #000000; --bg-panel: rgba(0, 20, 0, 0.95); }
        body.theme-fire { --primary-color: #ffbd2e; --secondary-color: #ff0055; --bg-dark: #1a0505; --bg-panel: rgba(40, 10, 10, 0.95); }
        body.theme-retro { --primary-color: #fca311; --secondary-color: #14213d; --bg-dark: #101010; --bg-panel: #1a1a1a; --font-display: 'Press Start 2P', cursive; }
        body.theme-light { --primary-color: #007bff; --secondary-color: #6c757d; --bg-dark: #f8f9fa; --bg-panel: #ffffff; --text-main: #212529; --text-dim: #6c757d; }
        body.theme-dark { --primary-color: #e83e8c; --secondary-color: #6f42c1; --bg-dark: #000000; --bg-panel: rgba(20, 20, 20, 0.95); }
        @keyframes rgb-color-cycle { 0% { --primary-color: #ff00de; } 25% { --primary-color: #00ffde; } 50% { --primary-color: #de00ff; } 75% { --primary-color: #ffde00; } 100% { --primary-color: #ff00de; } }
        body.theme-rgb { animation: rgb-color-cycle 8s linear infinite; }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-body); background: linear-gradient(135deg, var(--bg-dark) 0%, #0a1628 50%, var(--bg-dark) 100%); color: var(--text-main); min-height: 100vh; }

        /* Header */
        header {
            background: var(--bg-panel);
            border-bottom: 1px solid rgba(0,243,255,0.2);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-family: var(--font-display); font-size: 18px; color: var(--primary-color); text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .main-nav { display: flex; gap: 10px; align-items: center; }
        .nav-btn { background: transparent; border: 1px solid transparent; color: var(--text-dim); padding: 8px 16px; border-radius: 20px; cursor: pointer; font-family: var(--font-display); text-decoration: none; font-size: 11px; transition: 0.3s; }
        .nav-btn:hover, .nav-btn.active { background: rgba(255,255,255,0.1); color: var(--primary-color); }
        .nav-btn.primary { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: #000; font-weight: bold; padding: 8px 20px; border: none; }
        .nav-btn.primary:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(0,243,255,0.5); }
        .nav-menu-container { position: relative; }
        .nav-menu-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(0,243,255,0.3); color: var(--text-main); padding: 8px 15px; border-radius: 15px; cursor: pointer; font-family: var(--font-display); font-size: 11px; display: flex; align-items: center; gap: 8px; transition: 0.3s; }
        .nav-menu-btn:hover { background: rgba(255,255,255,0.15); color: var(--primary-color); }
        .nav-menu-dropdown { position: absolute; top: 100%; right: 0; margin-top: 10px; background: rgba(16, 26, 46, 0.98); border: 1px solid rgba(0,243,255,0.2); border-radius: 12px; min-width: 200px; padding: 10px 0; box-shadow: 0 10px 40px rgba(0,0,0,0.5); opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.3s ease; z-index: 1000; }
        .nav-menu-container:hover .nav-menu-dropdown { opacity: 1; visibility: visible; transform: translateY(0); }
        .nav-menu-dropdown a { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: var(--text-main); text-decoration: none; font-size: 14px; transition: 0.2s; }
        .nav-menu-dropdown a:hover { background: rgba(0,243,255,0.1); color: var(--primary-color); }
        .nav-menu-dropdown a i { width: 20px; text-align: center; color: var(--primary-color); }

        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }

        /* Challenge Card */
        .challenge-hero {
            background: var(--bg-panel);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid var(--glass-border);
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        .challenge-hero::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            opacity: 0.05;
            pointer-events: none;
        }

        .challenge-date {
            font-family: var(--font-display);
            font-size: 14px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        .challenge-title {
            font-family: var(--font-display);
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .challenge-subtitle { color: var(--text-dim); font-size: 18px; margin-bottom: 30px; }

        /* Timer */
        .challenge-timer {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        .timer-block {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px 25px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }
        .timer-value {
            font-family: var(--font-display);
            font-size: 36px;
            color: var(--primary-color);
        }
        .timer-label { font-size: 12px; color: var(--text-dim); text-transform: uppercase; }

        /* Challenge Types Grid */
        .challenge-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .challenge-type-card {
            background: var(--bg-panel);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid var(--glass-border);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        .challenge-type-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,243,255,0.2);
        }
        .challenge-type-card.active {
            border-color: var(--primary-color);
            background: rgba(0,243,255,0.05);
        }
        .challenge-type-card.completed {
            border-color: var(--success);
            background: rgba(0,255,157,0.05);
        }
        .challenge-type-card.completed::after {
            content: '‚úì';
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #000;
        }
        .challenge-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        .challenge-name {
            font-family: var(--font-display);
            font-size: 16px;
            margin-bottom: 10px;
        }
        .challenge-desc { color: var(--text-dim); font-size: 14px; line-height: 1.5; }
        .challenge-reward {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-top: 15px;
            padding: 5px 12px;
            background: rgba(255,215,0,0.1);
            border-radius: 20px;
            color: var(--gold);
            font-size: 12px;
        }

        /* Current Challenge */
        .current-challenge {
            background: var(--bg-panel);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid var(--primary-color);
            margin-bottom: 30px;
        }
        .current-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .current-title {
            font-family: var(--font-display);
            font-size: 20px;
            color: var(--primary-color);
        }
        .current-xp {
            background: linear-gradient(135deg, var(--gold), #ffa500);
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }

        .challenge-game {
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .challenge-game-img {
            width: 200px;
            height: 94px;
            border-radius: 10px;
            object-fit: cover;
        }
        .challenge-game-info { flex: 1; }
        .challenge-game-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .challenge-game-meta { color: var(--text-dim); font-size: 14px; }

        .challenge-objective {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .objective-title { font-size: 14px; color: var(--text-dim); margin-bottom: 10px; }
        .objective-text { font-size: 18px; font-weight: bold; }

        .challenge-progress {
            margin-top: 20px;
        }
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .progress-bar-bg {
            height: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Buttons */
        .btn-row { display: flex; gap: 15px; justify-content: center; margin-top: 25px; }
        .btn {
            padding: 12px 30px;
            border-radius: 25px;
            border: none;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: #000;
        }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0,243,255,0.3); }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: var(--text-main);
            border: 1px solid var(--glass-border);
        }
        .btn-secondary:hover { background: rgba(255,255,255,0.2); }

        /* Streak */
        .streak-card {
            background: var(--bg-panel);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--glass-border);
            text-align: center;
        }
        .streak-icon { font-size: 50px; margin-bottom: 10px; }
        .streak-value {
            font-family: var(--font-display);
            font-size: 48px;
            background: linear-gradient(135deg, var(--warning), #ff6600);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .streak-label { color: var(--text-dim); font-size: 14px; }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        .stat-card {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }
        .stat-value {
            font-family: var(--font-display);
            font-size: 28px;
            color: var(--primary-color);
        }
        .stat-label { color: var(--text-dim); font-size: 12px; margin-top: 5px; }

        /* No Library */
        .no-library {
            text-align: center;
            padding: 60px 20px;
        }
        .no-library i { font-size: 60px; color: var(--text-dim); margin-bottom: 20px; }
        .no-library h2 { margin-bottom: 10px; }
        .no-library p { color: var(--text-dim); margin-bottom: 20px; }

        /* History */
        .history-section { margin-top: 40px; }
        .history-title {
            font-family: var(--font-display);
            font-size: 18px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .history-list { display: flex; flex-direction: column; gap: 10px; }
        .history-item {
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--bg-panel);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
        }
        .history-item.success { border-left: 3px solid var(--success); }
        .history-item.failed { border-left: 3px solid var(--danger); opacity: 0.7; }
        .history-date { color: var(--text-dim); font-size: 12px; min-width: 80px; }
        .history-game { flex: 1; }
        .history-status { font-weight: bold; }
        .history-status.success { color: var(--success); }
        .history-status.failed { color: var(--danger); }

        /* ========== RESPONSIVE DESIGN ========== */
        @media (max-width: 768px) {
            header { flex-direction: column; gap: 15px; padding: 15px; }
            .main-nav { flex-wrap: wrap; justify-content: center; gap: 8px; }
            .nav-btn { padding: 6px 12px; font-size: 10px; }
            .nav-menu-dropdown { position: fixed; top: auto; bottom: 0; left: 0; right: 0; border-radius: 20px 20px 0 0; min-width: 100%; }
            .logo { font-size: 14px; }
            
            .container { padding: 15px 10px; }
            
            .challenge-hero { padding: 20px 15px; }
            .challenge-title { font-size: 22px; }
            .challenge-subtitle { font-size: 14px; }
            
            .challenge-timer { gap: 10px; }
            .timer-block { padding: 10px 15px; }
            .timer-value { font-size: 24px; }
            .timer-label { font-size: 10px; }
            
            .challenge-types { grid-template-columns: 1fr; gap: 15px; }
            .challenge-type-card { padding: 20px; }
            .challenge-icon { font-size: 30px; }
            .challenge-name { font-size: 14px; }
            
            .current-challenge { padding: 20px 15px; }
            .current-header { flex-direction: column; gap: 10px; text-align: center; }
            .current-title { font-size: 16px; }
            
            .challenge-game { flex-direction: column; text-align: center; gap: 15px; }
            .challenge-game-img { width: 100%; max-width: 280px; height: auto; }
            .challenge-game-name { font-size: 16px; }
            
            .btn-row { flex-direction: column; gap: 10px; }
            .btn { width: 100%; justify-content: center; }
            
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .stat-card { padding: 15px; }
            .stat-value { font-size: 22px; }
            
            .history-item { flex-direction: column; align-items: flex-start; gap: 8px; }
            .history-date { min-width: auto; }
        }

        @media (max-width: 480px) {
            .challenge-title { font-size: 18px; }
            .timer-value { font-size: 20px; }
            .timer-block { padding: 8px 12px; }
            
            .stats-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
            .stat-value { font-size: 20px; }
            
            .btn { padding: 10px 20px; font-size: 12px; }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="logo"><i class="fab fa-steam"></i> STEAM EXPLORER</a>
        <nav class="main-nav">
            <a href="desafio.html" class="nav-btn primary active"><i class="fas fa-calendar-check"></i> <span data-i18n-key="nav_challenge">DESAFIO</span></a>
            <div class="nav-menu-container">
                <button class="nav-menu-btn"><i class="fas fa-bars"></i> <span data-i18n-key="menu">MENU</span> <i class="fas fa-chevron-down" style="font-size:8px;"></i></button>
                <div class="nav-menu-dropdown">
                    <a href="index.html"><i class="fas fa-gamepad"></i> <span data-i18n-key="nav_library">Biblioteca</span></a>
                    <a href="hall.html"><i class="fas fa-trophy"></i> <span data-i18n-key="nav_hall">Hall da Fama</span></a>
                    <a href="roleta.html"><i class="fas fa-dice"></i> <span data-i18n-key="nav_roulette">Roleta</span></a>
                    <a href="level.html"><i class="fas fa-star"></i> <span data-i18n-key="nav_xp">Level / XP</span></a>
                    <a href="prices.html"><i class="fas fa-chart-line"></i> <span data-i18n-key="priceHistory">Hist√≥rico Pre√ßos</span></a>
                    <a href="compare.html"><i class="fas fa-users"></i> <span data-i18n-key="compareProfiles">Comparar Perfis</span></a>
                    <a href="museum.html"><i class="fas fa-landmark"></i> Museu 3D</a>
                    <a href="wallpaper.html"><i class="fas fa-image"></i> <span data-i18n-key="nav_wallpaper">Wallpapers</span></a>
                    <a href="timeline.html"><i class="fas fa-clock-rotate-left"></i> <span data-i18n-key="nav_timeline">Timeline</span></a>
                    <a href="hardware_check.html"><i class="fas fa-microchip"></i> <span data-i18n-key="nav_hardware">Hardware Lab</span></a>
                    <a href="wrapped.html"><i class="fas fa-gift"></i> Wrapped</a>
                </div>
            </div>
            <select id="langSelector" onchange="setLanguage(this.value)" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); color: var(--text-main); padding: 6px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">
                <option value="pt">üáßüá∑ PT</option>
                <option value="en">üá∫üá∏ EN</option>
                <option value="es">üá™üá∏ ES</option>
                <option value="fr">üá´üá∑ FR</option>
                <option value="de">üá©üá™ DE</option>
                <option value="ru">üá∑üá∫ RU</option>
                <option value="ja">üáØüáµ JA</option>
                <option value="zh">üá®üá≥ ZH</option>
            </select>
        </nav>
    </header>

    <div class="container">
        <!-- Hero Section -->
        <div class="challenge-hero">
            <div class="challenge-date" id="challengeDate">1 DE DEZEMBRO DE 2025</div>
            <h1 class="challenge-title" data-i18n-key="dailyChallenge">DESAFIO DI√ÅRIO</h1>
            <p class="challenge-subtitle" data-i18n-key="challengeDescription">Complete desafios di√°rios para ganhar XP b√¥nus e manter sua sequ√™ncia!</p>
            
            <div class="challenge-timer">
                <div class="timer-block">
                    <div class="timer-value" id="timerHours">23</div>
                    <div class="timer-label">Horas</div>
                </div>
                <div class="timer-block">
                    <div class="timer-value" id="timerMinutes">59</div>
                    <div class="timer-label">Minutos</div>
                </div>
                <div class="timer-block">
                    <div class="timer-value" id="timerSeconds">59</div>
                    <div class="timer-label">Segundos</div>
                </div>
            </div>
        </div>

        <!-- Challenge Types -->
        <div class="challenge-types" id="challengeTypes">
            <div class="challenge-type-card" onclick="selectChallengeType('easy')">
                <div class="challenge-icon">üéÆ</div>
                <div class="challenge-name">DESAFIO F√ÅCIL</div>
                <div class="challenge-desc">Jogue qualquer jogo por 30 minutos ou desbloqueie 1 conquista</div>
                <div class="challenge-reward"><i class="fas fa-star"></i> +100 XP</div>
            </div>
            <div class="challenge-type-card" onclick="selectChallengeType('medium')">
                <div class="challenge-icon">üèÜ</div>
                <div class="challenge-name">DESAFIO M√âDIO</div>
                <div class="challenge-desc">Desbloqueie 3 conquistas em um jogo espec√≠fico</div>
                <div class="challenge-reward"><i class="fas fa-star"></i> +300 XP</div>
            </div>
            <div class="challenge-type-card" onclick="selectChallengeType('hard')">
                <div class="challenge-icon">üíé</div>
                <div class="challenge-name">DESAFIO DIF√çCIL</div>
                <div class="challenge-desc">Desbloqueie uma conquista rara (menos de 10% dos jogadores)</div>
                <div class="challenge-reward"><i class="fas fa-star"></i> +500 XP</div>
            </div>
        </div>

        <!-- Current Challenge -->
        <div class="current-challenge" id="currentChallenge" style="display: none;">
            <div class="current-header">
                <h2 class="current-title"><i class="fas fa-crosshairs"></i> SEU DESAFIO DE HOJE</h2>
                <div class="current-xp" id="challengeXP">+300 XP</div>
            </div>

            <div class="challenge-game">
                <img class="challenge-game-img" id="challengeGameImg" src="https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/1245620/header.jpg" alt="Game">
                <div class="challenge-game-info">
                    <div class="challenge-game-name" id="challengeGameName">Elden Ring</div>
                    <div class="challenge-game-meta" id="challengeGameMeta">15 conquistas restantes ‚Ä¢ 85% completo</div>
                </div>
            </div>

            <div class="challenge-objective">
                <div class="objective-title">OBJETIVO</div>
                <div class="objective-text" id="challengeObjective">Desbloqueie 3 conquistas neste jogo hoje</div>
            </div>

            <div class="challenge-progress">
                <div class="progress-header">
                    <span>Progresso</span>
                    <span id="progressText">0/3 conquistas</span>
                </div>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-primary" onclick="openSteamGame()">
                    <i class="fab fa-steam"></i> Abrir no Steam
                </button>
                <button class="btn btn-secondary" onclick="checkProgress()">
                    <i class="fas fa-sync-alt"></i> Atualizar Progresso
                </button>
                <button class="btn btn-secondary" onclick="regenerateChallenge()">
                    <i class="fas fa-redo"></i> Novo Desafio
                </button>
                <button class="btn btn-primary" id="completeBtn" onclick="markCompleted()">
                    <i class="fas fa-check"></i> Validar e Completar
                </button>
            </div>
        </div>

        <!-- No Library State -->
        <div class="no-library" id="noLibrary" style="display: none;">
            <i class="fas fa-gamepad"></i>
            <h2>Nenhuma biblioteca carregada</h2>
            <p>Primeiro, pesquise sua Steam ID na p√°gina principal para gerar desafios personalizados</p>
            <a href="index.html" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i> Ir para Biblioteca
            </a>
        </div>

        <!-- Stats -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-value" id="statStreak">0</div>
                <div class="stat-label">üî• Sequ√™ncia Atual</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statCompleted">0</div>
                <div class="stat-label">‚úÖ Desafios Completos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statXPEarned">0</div>
                <div class="stat-label">‚≠ê XP Ganho</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statBestStreak">0</div>
                <div class="stat-label">üèÜ Maior Sequ√™ncia</div>
            </div>
        </div>

        <!-- History -->
        <div class="history-section">
            <h3 class="history-title"><i class="fas fa-history"></i> Hist√≥rico de Desafios</h3>
            <div class="history-list" id="historyList">
                <div class="history-item success">
                    <div class="history-date">30 Nov</div>
                    <div class="history-game">Hollow Knight - Desbloqueie 3 conquistas</div>
                    <div class="history-status success">‚úì Completo</div>
                </div>
                <div class="history-item failed">
                    <div class="history-date">29 Nov</div>
                    <div class="history-game">Elden Ring - Conquista rara</div>
                    <div class="history-status failed">‚úó N√£o completou</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Estado
        let currentChallenge = null;
        let challengeStats = {
            streak: 0,
            completed: 0,
            xpEarned: 0,
            bestStreak: 0,
            history: []
        };
        let userGames = [];

        // Tipos de desafio
        const challengeTypes = {
            easy: {
                name: 'F√°cil',
                xp: 100,
                objectives: [
                    { text: 'Jogue {game} por 30 minutos', type: 'playtime' },
                    { text: 'Desbloqueie 1 conquista em {game}', type: 'achievements', count: 1 }
                ]
            },
            medium: {
                name: 'M√©dio',
                xp: 300,
                objectives: [
                    { text: 'Desbloqueie 3 conquistas em {game}', type: 'achievements', count: 3 },
                    { text: 'Alcance 50% de progresso em {game}', type: 'progress' }
                ]
            },
            hard: {
                name: 'Dif√≠cil',
                xp: 500,
                objectives: [
                    { text: 'Desbloqueie uma conquista rara em {game}', type: 'rare' },
                    { text: 'Complete 5 conquistas em {game}', type: 'achievements', count: 5 }
                ]
            }
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadUserGames();
            loadChallengeStats();
            updateDate();
            startTimer();
            checkTodayChallenge();
        });

        // Fun√ß√£o helper para obter Steam ID de forma consistente
        function getSteamId() {
            return localStorage.getItem('steamId') || localStorage.getItem('lastSteamId');
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'default';
            document.body.classList.remove('theme-rgb', 'theme-retro', 'theme-light', 'theme-dark', 'theme-matrix', 'theme-fire');
            if (savedTheme !== 'default') {
                document.body.classList.add('theme-' + savedTheme);
            }
        }

        function loadUserGames() {
            const savedGames = localStorage.getItem('currentGames');
            if (savedGames) {
                userGames = JSON.parse(savedGames);
                document.getElementById('noLibrary').style.display = 'none';
            } else {
                document.getElementById('noLibrary').style.display = 'block';
                document.getElementById('challengeTypes').style.display = 'none';
                document.getElementById('statsGrid').style.display = 'none';
            }
        }

        function loadChallengeStats() {
            const saved = localStorage.getItem('challengeStats');
            if (saved) {
                challengeStats = JSON.parse(saved);
                updateStatsUI();
                renderHistory();
            }
        }

        function saveChallengeStats() {
            localStorage.setItem('challengeStats', JSON.stringify(challengeStats));
            updateStatsUI();
        }

        function updateStatsUI() {
            document.getElementById('statStreak').textContent = challengeStats.streak;
            document.getElementById('statCompleted').textContent = challengeStats.completed;
            document.getElementById('statXPEarned').textContent = challengeStats.xpEarned.toLocaleString();
            document.getElementById('statBestStreak').textContent = challengeStats.bestStreak;
        }

        function updateDate() {
            const now = new Date();
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            document.getElementById('challengeDate').textContent = now.toLocaleDateString('pt-BR', options).toUpperCase();
        }

        function startTimer() {
            function update() {
                const now = new Date();
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(0, 0, 0, 0);
                
                const diff = tomorrow - now;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('timerHours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('timerMinutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('timerSeconds').textContent = seconds.toString().padStart(2, '0');
            }
            update();
            setInterval(update, 1000);
        }

        function checkTodayChallenge() {
            const saved = localStorage.getItem('todayChallenge');
            if (saved) {
                const data = JSON.parse(saved);
                const today = new Date().toDateString();
                if (data.date === today) {
                    currentChallenge = data;
                    showCurrentChallenge();
                    
                    // Marcar tipo como ativo
                    document.querySelectorAll('.challenge-type-card').forEach(card => {
                        card.classList.remove('active');
                    });
                }
            }
        }

        function selectChallengeType(type) {
            if (userGames.length === 0) {
                document.getElementById('statusMessage').innerHTML = '<i class="fas fa-exclamation-triangle"></i> Carregue sua biblioteca primeiro na p√°gina principal';
                document.getElementById('statusMessage').style.color = 'var(--warning)';
                return;
            }

            generateChallenge(type);
        }

        function generateChallenge(type) {
            const typeConfig = challengeTypes[type];
            
            // Escolher jogo aleat√≥rio (priorizar jogos n√£o-100%)
            const eligibleGames = userGames.filter(g => g.percent < 100 && g.percent > 0);
            const gamePool = eligibleGames.length > 0 ? eligibleGames : userGames;
            const game = gamePool[Math.floor(Math.random() * gamePool.length)];
            
            // Escolher objetivo aleat√≥rio
            const objective = typeConfig.objectives[Math.floor(Math.random() * typeConfig.objectives.length)];
            
            currentChallenge = {
                date: new Date().toDateString(),
                type: type,
                game: game,
                objective: objective.text.replace('{game}', game.name),
                objectiveType: objective.type,
                objectiveCount: objective.count || 1,
                xp: typeConfig.xp,
                progress: 0,
                completed: false,
                // Salvar estado inicial para valida√ß√£o
                initialUnlocked: game.unlocked,
                initialPercent: game.percent,
                initialPlaytime: game.playtime_forever || 0,
                createdAt: Date.now()
            };

            localStorage.setItem('todayChallenge', JSON.stringify(currentChallenge));
            showCurrentChallenge();
        }

        function showCurrentChallenge() {
            document.getElementById('currentChallenge').style.display = 'block';
            document.getElementById('challengeGameName').textContent = currentChallenge.game.name;
            document.getElementById('challengeGameImg').src = `https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/${currentChallenge.game.appid}/header.jpg`;
            
            const remaining = currentChallenge.game.total - currentChallenge.game.unlocked;
            document.getElementById('challengeGameMeta').textContent = `${remaining} conquistas restantes ‚Ä¢ ${currentChallenge.game.percent}% completo`;
            
            document.getElementById('challengeObjective').textContent = currentChallenge.objective;
            document.getElementById('challengeXP').textContent = `+${currentChallenge.xp} XP`;
            
            updateProgress();
        }

        function updateProgress() {
            if (!currentChallenge) return;
            
            const progress = currentChallenge.progress;
            const max = currentChallenge.objectiveCount;
            const percent = Math.min(100, (progress / max) * 100);
            
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').textContent = `${progress}/${max} ${currentChallenge.objectiveType === 'achievements' ? 'conquistas' : ''}`;
        }

        async function checkProgress() {
            if (!currentChallenge) return;
            
            const steamId = getSteamId();
            if (!steamId) {
                showValidationError('Steam ID n√£o encontrado', 'Fa√ßa login novamente na p√°gina principal pesquisando seu Steam ID.');
                return;
            }
            
            const progressText = document.getElementById('progressText');
            progressText.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
            
            try {
                const appid = currentChallenge.game.appid;
                const response = await fetch(`http://localhost:3000/api/achievements/${steamId}/${appid}`);
                
                if (!response.ok) throw new Error('Erro ao buscar dados');
                
                const data = await response.json();
                const currentUnlocked = data.achievements ? data.achievements.filter(a => a.achieved).length : 0;
                const initialUnlocked = currentChallenge.initialUnlocked || 0;
                const newAchievements = currentUnlocked - initialUnlocked;
                
                // Tamb√©m verificar tempo de jogo
                let currentPlaytime = currentChallenge.initialPlaytime || 0;
                let newPlaytimeMinutes = 0;
                try {
                    const gamesResponse = await fetch(`http://localhost:3000/api/games/${steamId}`);
                    if (gamesResponse.ok) {
                        const gamesData = await gamesResponse.json();
                        const gameInfo = gamesData.games?.find(g => g.appid == appid);
                        if (gameInfo) {
                            currentPlaytime = gameInfo.playtime_forever || 0;
                            newPlaytimeMinutes = currentPlaytime - (currentChallenge.initialPlaytime || 0);
                        }
                    }
                } catch (e) {}
                
                // Atualizar progresso baseado no tipo
                const objectiveType = currentChallenge.objectiveType;
                let progressInfo = '';
                let progressValue = 0;
                let progressMax = currentChallenge.objectiveCount;
                
                switch (objectiveType) {
                    case 'achievements':
                        progressValue = Math.max(0, newAchievements);
                        progressInfo = `${progressValue}/${progressMax} conquistas novas`;
                        break;
                    case 'playtime':
                        progressMax = 30;
                        progressValue = Math.min(progressMax, newPlaytimeMinutes);
                        progressInfo = `${progressValue}/${progressMax} minutos jogados`;
                        break;
                    case 'progress':
                        const currentPercent = data.achievements ? Math.round((currentUnlocked / data.achievements.length) * 100) : 0;
                        progressValue = currentPercent >= 50 ? 1 : 0;
                        progressMax = 1;
                        progressInfo = `${currentPercent}% de conclus√£o (meta: 50%)`;
                        break;
                    case 'rare':
                        progressValue = newAchievements > 0 ? 1 : 0;
                        progressMax = 1;
                        progressInfo = newAchievements > 0 ? '‚úì Conquista desbloqueada!' : 'Desbloqueie uma conquista rara';
                        break;
                }
                
                currentChallenge.progress = progressValue;
                localStorage.setItem('todayChallenge', JSON.stringify(currentChallenge));
                
                const percent = Math.min(100, (progressValue / progressMax) * 100);
                document.getElementById('progressBar').style.width = percent + '%';
                
                if (progressValue >= progressMax) {
                    progressText.innerHTML = `<i class="fas fa-check-circle" style="color: var(--success);"></i> ${progressInfo} - Pronto para validar!`;
                    document.getElementById('progressBar').style.background = 'linear-gradient(90deg, var(--success), #00cc7a)';
                } else {
                    progressText.innerHTML = `<i class="fas fa-clock" style="color: var(--warning);"></i> ${progressInfo}`;
                }
                
            } catch (error) {
                console.error('Erro ao verificar progresso:', error);
                progressText.innerHTML = '<i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i> Erro ao verificar. Tente novamente.';
            }
        }

        function regenerateChallenge() {
            if (confirm('Deseja gerar um novo desafio? Voc√™ perder√° o progresso atual.')) {
                const type = currentChallenge ? currentChallenge.type : 'medium';
                generateChallenge(type);
            }
        }

        function openSteamGame() {
            if (currentChallenge && currentChallenge.game) {
                window.open(`steam://run/${currentChallenge.game.appid}`, '_blank');
            }
        }

        async function markCompleted() {
            if (!currentChallenge || currentChallenge.completed) return;
            
            const btn = document.getElementById('completeBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
            btn.disabled = true;
            
            try {
                // Verificar o progresso real do usu√°rio
                const validationResult = await validateChallengeCompletion();
                
                if (!validationResult.success) {
                    showValidationError(validationResult.message, validationResult.details);
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    return;
                }
                
                // Desafio validado com sucesso!
                currentChallenge.completed = true;
                currentChallenge.progress = currentChallenge.objectiveCount;
                currentChallenge.validatedAt = Date.now();
                currentChallenge.validationData = validationResult.data;
                
                // Atualizar stats
                challengeStats.completed++;
                challengeStats.xpEarned += currentChallenge.xp;
                challengeStats.streak++;
                if (challengeStats.streak > challengeStats.bestStreak) {
                    challengeStats.bestStreak = challengeStats.streak;
                }
                
                // Adicionar ao hist√≥rico
                challengeStats.history.unshift({
                    date: new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' }),
                    game: currentChallenge.game.name,
                    objective: currentChallenge.objective.split(currentChallenge.game.name)[1] || 'Desafio',
                    success: true,
                    validated: true
                });
                if (challengeStats.history.length > 10) challengeStats.history.pop();
                
                saveChallengeStats();
                localStorage.setItem('todayChallenge', JSON.stringify(currentChallenge));
                
                updateProgress();
                renderHistory();
                
                // Feedback visual - animar o card
                const card = document.getElementById('currentChallenge');
                card.style.boxShadow = '0 0 30px var(--success)';
                card.style.borderColor = 'var(--success)';
                document.getElementById('progressText').innerHTML = `<i class="fas fa-check-circle"></i> +${currentChallenge.xp} XP ‚Ä¢ Sequ√™ncia: ${challengeStats.streak} dias`;
                
                btn.innerHTML = '<i class="fas fa-check"></i> Completado!';
                btn.style.background = 'var(--success)';
                btn.style.color = '#000';
                
            } catch (error) {
                console.error('Erro na valida√ß√£o:', error);
                showValidationError('Erro ao verificar', 'N√£o foi poss√≠vel conectar ao servidor. Tente novamente.');
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
        
        async function validateChallengeCompletion() {
            const steamId = getSteamId();
            if (!steamId) {
                return { success: false, message: 'Steam ID n√£o encontrado', details: 'Fa√ßa login novamente na p√°gina principal pesquisando seu Steam ID.' };
            }
            
            const appid = currentChallenge.game.appid;
            const objectiveType = currentChallenge.objectiveType;
            
            try {
                // Buscar dados atuais do jogo
                console.log(`üîç Verificando conquistas para AppID ${appid}, Steam ID ${steamId}`);
                const response = await fetch(`http://localhost:3000/api/achievements/${steamId}/${appid}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå Erro na API:', response.status, errorText);
                    
                    if (response.status === 404) {
                        return { success: false, message: 'Jogo n√£o encontrado', details: 'Este jogo n√£o possui conquistas ou n√£o foi encontrado na sua conta.' };
                    } else if (response.status === 403) {
                        return { success: false, message: 'Perfil privado', details: 'Seu perfil Steam pode estar privado. Deixe-o p√∫blico para validar conquistas.' };
                    }
                    return { success: false, message: 'Erro de conex√£o', details: `O servidor retornou erro ${response.status}. Verifique se o servidor est√° rodando (node server.js).` };
                }
                
                const data = await response.json();
                console.log('‚úÖ Dados recebidos:', data);
                const currentUnlocked = data.achievements ? data.achievements.filter(a => a.achieved).length : 0;
                const currentPercent = data.achievements ? Math.round((currentUnlocked / data.achievements.length) * 100) : 0;
                
                // Tamb√©m buscar tempo de jogo atualizado
                let currentPlaytime = currentChallenge.initialPlaytime;
                try {
                    const gamesResponse = await fetch(`http://localhost:3000/api/games/${steamId}`);
                    if (gamesResponse.ok) {
                        const gamesData = await gamesResponse.json();
                        const gameInfo = gamesData.games?.find(g => g.appid == appid);
                        if (gameInfo) {
                            currentPlaytime = gameInfo.playtime_forever || 0;
                        }
                    }
                } catch (e) {
                    console.log('N√£o foi poss√≠vel verificar tempo de jogo');
                }
                
                const initialUnlocked = currentChallenge.initialUnlocked || 0;
                const initialPercent = currentChallenge.initialPercent || 0;
                const initialPlaytime = currentChallenge.initialPlaytime || 0;
                
                const newAchievements = currentUnlocked - initialUnlocked;
                const newPlaytimeMinutes = currentPlaytime - initialPlaytime;
                const progressDiff = currentPercent - initialPercent;
                
                // Validar baseado no tipo de objetivo
                switch (objectiveType) {
                    case 'achievements':
                        const requiredCount = currentChallenge.objectiveCount;
                        if (newAchievements >= requiredCount) {
                            return { 
                                success: true, 
                                data: { newAchievements, currentUnlocked, initialUnlocked }
                            };
                        } else {
                            return { 
                                success: false, 
                                message: 'Conquistas insuficientes', 
                                details: `Voc√™ precisa desbloquear ${requiredCount} conquista(s) novas.\nProgresso atual: ${newAchievements}/${requiredCount} conquista(s) desbloqueada(s) desde o in√≠cio do desafio.`
                            };
                        }
                    
                    case 'playtime':
                        const requiredMinutes = 30; // 30 minutos para desafio de tempo
                        if (newPlaytimeMinutes >= requiredMinutes) {
                            return { 
                                success: true, 
                                data: { newPlaytimeMinutes, currentPlaytime, initialPlaytime }
                            };
                        } else {
                            return { 
                                success: false, 
                                message: 'Tempo insuficiente', 
                                details: `Voc√™ precisa jogar pelo menos ${requiredMinutes} minutos.\nProgresso atual: ${newPlaytimeMinutes} minutos jogados desde o in√≠cio do desafio.`
                            };
                        }
                    
                    case 'progress':
                        const requiredProgress = 50 - initialPercent; // Alcan√ßar 50%
                        if (currentPercent >= 50) {
                            return { 
                                success: true, 
                                data: { progressDiff, currentPercent, initialPercent }
                            };
                        } else {
                            return { 
                                success: false, 
                                message: 'Progresso insuficiente', 
                                details: `Voc√™ precisa alcan√ßar 50% de conclus√£o.\nProgresso atual: ${currentPercent}% (era ${initialPercent}% no in√≠cio do desafio).`
                            };
                        }
                    
                    case 'rare':
                        // Para conquista rara, verificar se desbloqueou alguma conquista com menos de 10% de jogadores
                        if (data.achievements) {
                            const rareAchievements = data.achievements.filter(a => a.achieved && a.percent && a.percent < 10);
                            // Verificar se alguma rara foi desbloqueada recentemente (ap√≥s in√≠cio do desafio)
                            const newRareUnlocked = newAchievements > 0 && rareAchievements.length > 0;
                            
                            if (newRareUnlocked || newAchievements > 0) {
                                // Verifica√ß√£o simplificada: se desbloqueou conquista, assume que pode ser rara
                                return { 
                                    success: true, 
                                    data: { newAchievements, rareCount: rareAchievements.length }
                                };
                            }
                        }
                        return { 
                            success: false, 
                            message: 'Nenhuma conquista rara', 
                            details: 'Desbloqueie uma conquista rara (menos de 10% dos jogadores t√™m) para completar este desafio.'
                        };
                    
                    default:
                        return { success: false, message: 'Tipo de desafio desconhecido', details: 'Por favor, gere um novo desafio.' };
                }
                
            } catch (error) {
                console.error('Erro ao validar:', error);
                return { success: false, message: 'Erro de conex√£o', details: 'N√£o foi poss√≠vel verificar seus dados. Verifique sua conex√£o e tente novamente.' };
            }
        }
        
        function showValidationError(title, message) {
            // Criar modal de erro
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: var(--bg-panel);
                    border: 2px solid var(--danger);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 400px;
                    text-align: center;
                ">
                    <i class="fas fa-times-circle" style="font-size: 50px; color: var(--danger); margin-bottom: 15px;"></i>
                    <h3 style="color: var(--danger); margin-bottom: 10px;">${title}</h3>
                    <p style="color: var(--text-dim); line-height: 1.6; white-space: pre-line;">${message}</p>
                    <button onclick="this.closest('div').parentElement.remove()" style="
                        margin-top: 20px;
                        padding: 10px 30px;
                        background: var(--danger);
                        border: none;
                        border-radius: 20px;
                        color: white;
                        cursor: pointer;
                        font-weight: bold;
                    ">Entendi</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        }

        function renderHistory() {
            const container = document.getElementById('historyList');
            container.innerHTML = '';
            
            if (challengeStats.history.length === 0) {
                container.innerHTML = '<p style="color: var(--text-dim); text-align: center; padding: 20px;">Nenhum desafio completado ainda</p>';
                return;
            }
            
            challengeStats.history.forEach(item => {
                const div = document.createElement('div');
                div.className = `history-item ${item.success ? 'success' : 'failed'}`;
                div.innerHTML = `
                    <div class="history-date">${item.date}</div>
                    <div class="history-game">${item.game} ${item.objective}</div>
                    <div class="history-status ${item.success ? 'success' : 'failed'}">${item.success ? '‚úì Completo' : '‚úó N√£o completou'}</div>
                `;
                container.appendChild(div);
            });
        }
    </script>
</body>
</html>
